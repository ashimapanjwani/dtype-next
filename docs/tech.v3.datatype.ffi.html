<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>tech.v3.datatype.ffi documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="highlight/solarized-light.css" /><script type="text/javascript" src="highlight/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a> with <a href="https://github.com/xsc/codox-theme-rdash">RDash UI</a> theme</h2><h1><a href="index.html"><span class="project-title"><span class="project-name">dtype-next</span> <span class="project-version">6.01</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Topics</span></h3><ul><li class="depth-1 "><a href="buffered-image.html"><div class="inner"><span>Buffered Image Support</span></div></a></li><li class="depth-1 "><a href="cheatsheet.html"><div class="inner"><span>Cheatsheet</span></div></a></li><li class="depth-1 "><a href="datatype-to-dtype-next.html"><div class="inner"><span>Why dtype-next?</span></div></a></li><li class="depth-1 "><a href="dimensions-bytecode-gen.html"><div class="inner"><span>Dimensions and Bytecode Generation</span></div></a></li><li class="depth-1 "><a href="overview.html"><div class="inner"><span>Overview</span></div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>tech</span></div></div></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>v3</span></div></div></li><li class="depth-3"><a href="tech.v3.datatype.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>datatype</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.datatype.argops.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>argops</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.datatype.bitmap.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>bitmap</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.datatype.datetime.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>datetime</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.datatype.errors.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>errors</span></div></a></li><li class="depth-4 branch current"><a href="tech.v3.datatype.ffi.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ffi</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.datatype.functional.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>functional</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.datatype.jna.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>jna</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.datatype.list.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>list</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.datatype.mmap.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>mmap</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.datatype.mmap-writer.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>mmap-writer</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.datatype.native-buffer.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>native-buffer</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.datatype.nippy.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>nippy</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.datatype.packing.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>packing</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.datatype.reductions.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>reductions</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.datatype.rolling.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>rolling</span></div></a></li><li class="depth-4"><a href="tech.v3.datatype.struct.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>struct</span></div></a></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree" style="top: -517px;"><span class="top" style="height: 526px;"></span><span class="bottom"></span></span><span>libs</span></div></div></li><li class="depth-4 branch"><a href="tech.v3.libs.buffered-image.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>buffered-image</span></div></a></li><li class="depth-4"><a href="tech.v3.libs.neanderthal.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>neanderthal</span></div></a></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>parallel</span></div></div></li><li class="depth-4"><a href="tech.v3.parallel.for.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>for</span></div></a></li><li class="depth-3"><a href="tech.v3.tensor.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>tensor</span></div></a></li><li class="depth-4 branch"><a href="tech.v3.tensor.color-gradients.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>color-gradients</span></div></a></li><li class="depth-4"><a href="tech.v3.tensor.dimensions.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>dimensions</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="tech.v3.datatype.ffi.html#var-arch64-set"><div class="inner"><span>arch64-set</span></div></a></li><li class="depth-1"><a href="tech.v3.datatype.ffi.html#var-c-.3Estring"><div class="inner"><span>c-&gt;string</span></div></a></li><li class="depth-1"><a href="tech.v3.datatype.ffi.html#var-define-foreign-interface"><div class="inner"><span>define-foreign-interface</span></div></a></li><li class="depth-1"><a href="tech.v3.datatype.ffi.html#var-define-library"><div class="inner"><span>define-library</span></div></a></li><li class="depth-1"><a href="tech.v3.datatype.ffi.html#var-find-function"><div class="inner"><span>find-function</span></div></a></li><li class="depth-1"><a href="tech.v3.datatype.ffi.html#var-find-symbol"><div class="inner"><span>find-symbol</span></div></a></li><li class="depth-1"><a href="tech.v3.datatype.ffi.html#var-foreign-interface-instance-.3Ec"><div class="inner"><span>foreign-interface-instance-&gt;c</span></div></a></li><li class="depth-1"><a href="tech.v3.datatype.ffi.html#var-instantiate-class"><div class="inner"><span>instantiate-class</span></div></a></li><li class="depth-1"><a href="tech.v3.datatype.ffi.html#var-instantiate-foreign-interface"><div class="inner"><span>instantiate-foreign-interface</span></div></a></li><li class="depth-1"><a href="tech.v3.datatype.ffi.html#var-instantiate-library"><div class="inner"><span>instantiate-library</span></div></a></li><li class="depth-1"><a href="tech.v3.datatype.ffi.html#var-jdk-ffi.3F"><div class="inner"><span>jdk-ffi?</span></div></a></li><li class="depth-1"><a href="tech.v3.datatype.ffi.html#var-jdk-mmodel.3F"><div class="inner"><span>jdk-mmodel?</span></div></a></li><li class="depth-1"><a href="tech.v3.datatype.ffi.html#var-jna-ffi.3F"><div class="inner"><span>jna-ffi?</span></div></a></li><li class="depth-1"><a href="tech.v3.datatype.ffi.html#var-load-library"><div class="inner"><span>load-library</span></div></a></li><li class="depth-1"><a href="tech.v3.datatype.ffi.html#var-lower-type"><div class="inner"><span>lower-type</span></div></a></li><li class="depth-1"><a href="tech.v3.datatype.ffi.html#var-PToPointer"><div class="inner"><span>PToPointer</span></div></a></li><li class="depth-2 branch"><a href="tech.v3.datatype.ffi.html#var--.3Epointer"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>-&gt;pointer</span></div></a></li><li class="depth-2"><a href="tech.v3.datatype.ffi.html#var-convertible-to-pointer.3F"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>convertible-to-pointer?</span></div></a></li><li class="depth-1"><a href="tech.v3.datatype.ffi.html#var-ptr-int-type"><div class="inner"><span>ptr-int-type</span></div></a></li><li class="depth-1"><a href="tech.v3.datatype.ffi.html#var-ptr-value"><div class="inner"><span>ptr-value</span></div></a></li><li class="depth-1"><a href="tech.v3.datatype.ffi.html#var-ptr-value.3F"><div class="inner"><span>ptr-value?</span></div></a></li><li class="depth-1"><a href="tech.v3.datatype.ffi.html#var-set-ffi-impl.21"><div class="inner"><span>set-ffi-impl!</span></div></a></li><li class="depth-1"><a href="tech.v3.datatype.ffi.html#var-size-t-size"><div class="inner"><span>size-t-size</span></div></a></li><li class="depth-1"><a href="tech.v3.datatype.ffi.html#var-size-t-type"><div class="inner"><span>size-t-type</span></div></a></li><li class="depth-1"><a href="tech.v3.datatype.ffi.html#var-string-.3Ec"><div class="inner"><span>string-&gt;c</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">tech.v3.datatype.ffi</h1><div class="doc"><div class="markdown"><p>Generalized C FFI interface that unifies JNA and JDK-16 FFI architectures.</p>
<p>Users can dynamically define and load libraries and define callbacks that C can then  call.</p>
<p>This namespace is meant to work with the <code>struct</code> namespace where you can define  C-structs laid out precisely in memory.</p>
<p>Available datatypes for the binding layer:</p>
<ul>
  <li><code>:int8</code> <code>:int16</code> <code>:int32</code> <code>:int64</code> <code>:float32</code> <code>:float64</code> <code>:pointer</code> <code>:pointer?</code> <code>:size-t</code>.</li>
</ul>
<p><code>:pointer</code>, <code>:pointer?</code>, <code>:size-t</code> are all types that change their underlying  definition depending on if the system is 32 bit or 64 bit.</p>
<p>Note that unsigned types will work but the interface will have to be defined in  terms of their signed analogues.</p>
<p>Example:</p>
<pre><code class="clojure"><br />user&gt; (require '[tech.v3.datatype :as dtype])
nil
user&gt; (require '[tech.v3.datatype.ffi :as dtype-ffi])
nil
user&gt; (def libmem-def (dtype-ffi/define-library
                        {:qsort {:rettype :void
                                 :argtypes [['data :pointer]
                                            ['nitems :size-t]
                                            ['item-size :size-t]
                                            ['comparator :pointer]]}}))
#'user/libmem-def
user&gt; (def libmem-inst (dtype-ffi/instantiate-library libmem-def nil))
#'user/libmem-inst
user&gt; (def         libmem-fns @libmem-inst)
#'user/libmem-fns
user&gt; (def         qsort (:qsort libmem-fns))
#'user/qsort
user&gt; (def comp-iface-def (dtype-ffi/define-foreign-interface :int32 [:pointer :pointer]))
#'user/comp-iface-def
user&gt; (require '[tech.v3.datatype.native-buffer :as native-buffer])
nil
user&gt; (def comp-iface-inst (dtype-ffi/instantiate-foreign-interface
                         comp-iface-def
                         (fn [^tech.v3.datatype.ffi.Pointer lhs ^tech.v3.datatype.ffi.Pointer rhs]
                           (let [lhs (.getDouble (native-buffer/unsafe) (.address lhs))
                                 rhs (.getDouble (native-buffer/unsafe) (.address rhs))]
                             (Double/compare lhs rhs)))))
#'user/comp-iface-inst
user&gt; (def comp-iface-ptr (dtype-ffi/foreign-interface-instance-&gt;c
                        comp-iface-def
                        comp-iface-inst))
#'user/comp-iface-ptr
user&gt; (def dbuf (dtype/make-container :native-heap :float64 (shuffle (range 100))))
09:00:27.900 [tech.resource.gc ref thread] INFO  tech.v3.resource.gc - Reference thread starting
#'user/dbuf
user&gt; dbuf
#native-buffer@0x00007F47084E4210&lt;float64&gt;[100]
[80.00, 90.00, 96.00, 29.00, 19.00, 12.00, 88.00, 94.00, 81.00, 17.00, 54.00, 52.00, 64.00, 86.00, 10.00, 76.00, 49.00, 5.000, 32.00, 69.00, ...]
user&gt; (qsort dbuf (dtype/ecount dbuf) Double/BYTES comp-iface-ptr)
nil
user&gt; dbuf
#native-buffer@0x00007F47084E4210&lt;float64&gt;[100]
[0.000, 1.000, 2.000, 3.000, 4.000, 5.000, 6.000, 7.000, 8.000, 9.000, 10.00, 11.00, 12.00, 13.00, 14.00, 15.00, 16.00, 17.00, 18.00, 19.00, ...]
</code></pre></div></div><div class="public anchor" id="var-arch64-set"><h3>arch64-set</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/cnuernber/dtype-next/blob/master/src/tech/v3/datatype/ffi.clj#L85">view source</a></div></div><div class="public anchor" id="var-c-.3Estring"><h3>c-&gt;string</h3><div class="usage"><code>(c-&gt;string data &amp; [encoding])</code></div><div class="doc"><div class="markdown"><p>Convert a zero-terminated c-string to a java string. See documentation for <code>string-&gt;c</code> for encodings.</p></div></div><div class="src-link"><a href="https://github.com/cnuernber/dtype-next/blob/master/src/tech/v3/datatype/ffi.clj#L187">view source</a></div></div><div class="public anchor" id="var-define-foreign-interface"><h3>define-foreign-interface</h3><div class="usage"><code>(define-foreign-interface rettype argtypes &amp; [{:as options}])</code></div><div class="doc"><div class="markdown"><p>Define a strongly typed instance that can be used with foreign-interface-instance-&gt;c. This instance takes a single constructor argument which is the IFn that it is wrapping. It has a single typesafe ‘invoke’ method taking types defined by the underlying binding and transforming them into types that Clojure expects - for instance pointers are transformed to/from <code>tech.v3.datatype.ffi.Pointer</code> upon entry/exit from the wrapped IFn.</p>
<ul>
  <li><code>rettype</code> - The return type of the function.</li>
  <li><code>argtypes</code> - A possibly empty sequence of argument types.</li>
</ul>
<p>Options:</p>
<ul>
  <li><code>:classname</code> - Similar to <code>:classname</code> in ‘define-library’. A class will be  generated to <em>compile-path</em> and after this statement <code>(import classname)</code> will  be a valid call.</li>
</ul>
<p>See foreign-interface-instance-&gt;c for example.</p></div></div><div class="src-link"><a href="https://github.com/cnuernber/dtype-next/blob/master/src/tech/v3/datatype/ffi.clj#L410">view source</a></div></div><div class="public anchor" id="var-define-library"><h3>define-library</h3><div class="usage"><code>(define-library fn-defs &amp; [options])</code></div><div class="doc"><div class="markdown"><p>Define a library returning the class. The class can be instantiated with a string  naming the library path or nil for the current process. After instantiation the  library instance will have strongly typed methods named the same as the  keyword keys in fn-defs efficiently bound to symbols of the same exact name in  library.</p>
<ul>
  <li><code>fn-defs</code> - map of fn-name -&gt; {:rettype :argtypes}.
    <ul>
      <li><code>argtypes</code> -</li>
      <li><code>:void</code> - return type only.</li>
      <li><code>:int8</code> <code>:int16</code> <code>:int32</code> <code>:int64</code></li>
      <li><code>:float32</code> <code>:float64</code></li>
      <li><code>:size-t</code> - int32 or int64 depending on cpu architecture.</li>
      <li><code>:pointer</code> <code>:pointer?</code> - Something convertible to a Pointer type. Potentially  exception when nil.</li>
      <li><code>rettype</code> - any argtype plus :void</li>
    </ul>
  </li>
</ul>
<p>Options:</p>
<ul>
  <li><code>:classname</code> - If classname (a symbol) is provided a .class file is saved to  <em>compile-path</em> after which <code>(import classname)</code> will be a validcall meaning that  after AOT no further reflection or class generation is required to access the  class explicitly. That being said ‘import’ does not reload classes that are  already on the classpath so this option is best used after library has stopped  changing.</li>
</ul>
<p>Example:</p>
<pre><code class="clojure">user&gt; (dtype-ffi/define-library {:memset {:rettype :pointer
                                          :argtypes [:pointer :int32 :size-t]}}
                                {:classname 'tech.libmemset})
{:library tech.libmemset}
user&gt; (import 'tech.libmemset)
tech.libmemset
user&gt; (def inst (tech.libmemset. nil)) ;;nil for current process
#'user/inst
user&gt; (def test-buf (dtype/make-container :native-heap :float32 (range 10)))
#'user/test-buf
user&gt; test-buf
#native-buffer@0x00007F4E28CE56D0&lt;float32&gt;[10]
[0.000, 1.000, 2.000, 3.000, 4.000, 5.000, 6.000, 7.000, 8.000, 9.000, ]
user&gt; (.memset ^tech.libmemset inst test-buf 0 40)
#object[tech.v3.datatype.ffi.Pointer 0x33013c57 "{:address 0x00007F4E28CE56D0 }"]
user&gt; test-buf
#native-buffer@0x00007F4E28CE56D0&lt;float32&gt;[10]
[0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, ]
user&gt;
</code></pre></div></div><div class="src-link"><a href="https://github.com/cnuernber/dtype-next/blob/master/src/tech/v3/datatype/ffi.clj#L311">view source</a></div></div><div class="public anchor" id="var-find-function"><h3>find-function</h3><div class="usage"><code>(find-function libname symbol-name rettype &amp; [argtypes options])</code></div><div class="doc"><div class="markdown"><p>Find the symbol and return an IFn implementation wrapping typesafe access to the function. The function’s signature has to be completely specified. Supported datatypes are</p>
<p>This object’s -&gt;pointer protocol implementation returns the actual function pointer. This function uses ‘eval’ and thus also uses reflection.</p></div></div><div class="src-link"><a href="https://github.com/cnuernber/dtype-next/blob/master/src/tech/v3/datatype/ffi.clj#L370">view source</a></div></div><div class="public anchor" id="var-find-symbol"><h3>find-symbol</h3><div class="usage"><code>(find-symbol libname symbol-name)</code><code>(find-symbol symbol-name)</code></div><div class="doc"><div class="markdown"><p>Find a symbol in a library. A library symbol is guaranteed to have a conversion to a pointer.</p></div></div><div class="src-link"><a href="https://github.com/cnuernber/dtype-next/blob/master/src/tech/v3/datatype/ffi.clj#L302">view source</a></div></div><div class="public anchor" id="var-foreign-interface-instance-.3Ec"><h3>foreign-interface-instance-&gt;c</h3><div class="usage"><code>(foreign-interface-instance-&gt;c ffi-def foreign-inst)</code></div><div class="doc"><div class="markdown"><p>Convert an instance of the above foreign interface definition into a Pointer suitable to be called from C. Callers must ensure that foreign-inst is visible to the gc the entire time the foreign system has a reference to the pointer.</p>
<ul>
  <li><code>foreign-inst</code> - an instance of the class defined by ‘define-foreign-interface’.</li>
</ul></div></div><div class="src-link"><a href="https://github.com/cnuernber/dtype-next/blob/master/src/tech/v3/datatype/ffi.clj#L440">view source</a></div></div><div class="public anchor" id="var-instantiate-class"><h3>instantiate-class</h3><div class="usage"><code>(instantiate-class cls &amp; args)</code></div><div class="doc"><div class="markdown"><p>Utility function to instantiate a class via its first constructor in its list of declared constructors. Works with classes returned from ‘define-library’ and ‘define-foreign-interface’. Uses reflection.</p></div></div><div class="src-link"><a href="https://github.com/cnuernber/dtype-next/blob/master/src/tech/v3/datatype/ffi.clj#L252">view source</a></div></div><div class="public anchor" id="var-instantiate-foreign-interface"><h3>instantiate-foreign-interface</h3><div class="usage"><code>(instantiate-foreign-interface ffi-def ifn)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/cnuernber/dtype-next/blob/master/src/tech/v3/datatype/ffi.clj#L432">view source</a></div></div><div class="public anchor" id="var-instantiate-library"><h3>instantiate-library</h3><div class="usage"><code>(instantiate-library library-def libpath)</code></div><div class="doc"><div class="markdown"><p>Uses reflection to instantiate a library</p></div></div><div class="src-link"><a href="https://github.com/cnuernber/dtype-next/blob/master/src/tech/v3/datatype/ffi.clj#L364">view source</a></div></div><div class="public anchor" id="var-jdk-ffi.3F"><h3>jdk-ffi?</h3><div class="usage"><code>(jdk-ffi?)</code></div><div class="doc"><div class="markdown"><p>Is the JDK foreign function interface available?</p></div></div><div class="src-link"><a href="https://github.com/cnuernber/dtype-next/blob/master/src/tech/v3/datatype/ffi.clj#L130">view source</a></div></div><div class="public anchor" id="var-jdk-mmodel.3F"><h3>jdk-mmodel?</h3><div class="usage"><code>(jdk-mmodel?)</code></div><div class="doc"><div class="markdown"><p>Is the JDK native memory model available?</p></div></div><div class="src-link"><a href="https://github.com/cnuernber/dtype-next/blob/master/src/tech/v3/datatype/ffi.clj#L146">view source</a></div></div><div class="public anchor" id="var-jna-ffi.3F"><h3>jna-ffi?</h3><div class="usage"><code>(jna-ffi?)</code></div><div class="doc"><div class="markdown"><p>Is JNA’s ffi interface available?</p></div></div><div class="src-link"><a href="https://github.com/cnuernber/dtype-next/blob/master/src/tech/v3/datatype/ffi.clj#L138">view source</a></div></div><div class="public anchor" id="var-load-library"><h3>load-library</h3><div class="usage"><code>(load-library libname)</code></div><div class="doc"><div class="markdown"><p>Load a library returning an implementation specific library instance.</p>
<p>Exception if the library cannot be found.</p></div></div><div class="src-link"><a href="https://github.com/cnuernber/dtype-next/blob/master/src/tech/v3/datatype/ffi.clj#L294">view source</a></div></div><div class="public anchor" id="var-lower-type"><h3>lower-type</h3><div class="usage"><code>(lower-type argtype)</code></div><div class="doc"><div class="markdown"><p>Downcast <code>:size-t</code> to its integer equivalent.</p></div></div><div class="src-link"><a href="https://github.com/cnuernber/dtype-next/blob/master/src/tech/v3/datatype/ffi.clj#L122">view source</a></div></div><div class="public anchor" id="var-PToPointer"><h3>PToPointer</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var--.3Epointer"><h3>-&gt;pointer</h3><div class="usage"><code>(-&gt;pointer item)</code></div><div class="doc"><div class="markdown"><p>Convert an item into a Pointer, throwing an exception upon failure.</p></div></div></div><div class="public anchor" id="var-convertible-to-pointer.3F"><h3>convertible-to-pointer?</h3><div class="usage"><code>(convertible-to-pointer? item)</code></div><div class="doc"><div class="markdown"><p>Query whether an item is convertible to a pointer.</p></div></div></div></div></div><div class="src-link"><a href="https://github.com/cnuernber/dtype-next/blob/master/src/tech/v3/datatype/ffi.clj#L154">view source</a></div></div><div class="public anchor" id="var-ptr-int-type"><h3>ptr-int-type</h3><div class="usage"><code>(ptr-int-type)</code></div><div class="doc"><div class="markdown"><p>Get the integer type of a pointer - either <code>:int32</code> or <code>:int64</code>.</p></div></div><div class="src-link"><a href="https://github.com/cnuernber/dtype-next/blob/master/src/tech/v3/datatype/ffi.clj#L116">view source</a></div></div><div class="public anchor" id="var-ptr-value"><h3>ptr-value</h3><div class="usage"><code>(ptr-value item)</code></div><div class="doc"><div class="markdown"><p>Item must not be nil. A long address is returned.</p></div></div><div class="src-link"><a href="https://github.com/cnuernber/dtype-next/blob/master/src/tech/v3/datatype/ffi.clj#L228">view source</a></div></div><div class="public anchor" id="var-ptr-value.3F"><h3>ptr-value?</h3><div class="usage"><code>(ptr-value? item)</code></div><div class="doc"><div class="markdown"><p>Item may be nil in which case 0 is returned.</p></div></div><div class="src-link"><a href="https://github.com/cnuernber/dtype-next/blob/master/src/tech/v3/datatype/ffi.clj#L244">view source</a></div></div><div class="public anchor" id="var-set-ffi-impl.21"><h3>set-ffi-impl!</h3><div class="usage"><code>(set-ffi-impl! ffi-kwd)</code></div><div class="doc"><div class="markdown"><p>Set the global ffi implementation. Options are * :jdk - namespace <code>'tech.v3.datatype.ffi.mmodel/ffi-fns</code> - only available with jdk’s foreign function module enabled. * :jna - namespace <code>''tech.v3.datatype.ffi.jna/ffi-fns</code> - available if JNA version 5+ is in the classpath.</p></div></div><div class="src-link"><a href="https://github.com/cnuernber/dtype-next/blob/master/src/tech/v3/datatype/ffi.clj#L265">view source</a></div></div><div class="public anchor" id="var-size-t-size"><h3>size-t-size</h3><div class="usage"><code>(size-t-size)</code></div><div class="doc"><div class="markdown"><p>Get the size in bytes of a size-t integer.</p></div></div><div class="src-link"><a href="https://github.com/cnuernber/dtype-next/blob/master/src/tech/v3/datatype/ffi.clj#L88">view source</a></div></div><div class="public anchor" id="var-size-t-type"><h3>size-t-type</h3><div class="usage"><code>(size-t-type)</code></div><div class="doc"><div class="markdown"><p>the size-t datatype - either <code>:int32</code> or <code>:int64</code>.</p></div></div><div class="src-link"><a href="https://github.com/cnuernber/dtype-next/blob/master/src/tech/v3/datatype/ffi.clj#L108">view source</a></div></div><div class="public anchor" id="var-string-.3Ec"><h3>string-&gt;c</h3><div class="usage"><code>(string-&gt;c str-data &amp; [encoding])</code></div><div class="doc"><div class="markdown"><p>Convert a java String to a zero-padded c-string. Available encodings are</p>
<ul>
  <li><code>:ascii</code>, <code>:utf-8</code> (default), <code>:utf-16</code>, and <code>:utf-32</code></li>
</ul>
<p>String data will be zero padded.</p></div></div><div class="src-link"><a href="https://github.com/cnuernber/dtype-next/blob/master/src/tech/v3/datatype/ffi.clj#L170">view source</a></div></div></div></body></html>